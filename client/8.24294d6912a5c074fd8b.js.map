{"version":3,"sources":["webpack:///./node_modules/mattermost-redux/actions/timezone.js","webpack:///./components/logged_in/index.js","webpack:///./components/logged_in/logged_in.jsx"],"names":["Object","defineProperty","exports","value","_extends","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","autoUpdateTimezone","deviceTimezone","_this","this","_ref","fn","gen","apply","Promise","resolve","reject","step","arg","info","error","done","then","err","_asyncToGenerator","regeneratorRuntime","mark","_callee","dispatch","getState","currentUer","currentTimezone","newTimezoneExists","timezone","updatedUser","wrap","_context","prev","next","_users","getCurrentUser","_timezone","getUserTimezone","id","automaticTimezone","useAutomaticTimezone","manualTimezone","_users2","updateMe","stop","_x","_x2","__webpack_require__","_reactRedux","_redux","_general","_route","connect","state","ownProps","license","getLicense","config","getConfig","showTermsOfService","shouldShowTermsOfService","mfaRequired","checkIfMFARequired","match","url","enableTimezone","ExperimentalTimezone","actions","bindActionCreators","LoggedIn","_reactRouter","_channels","GlobalActions","WebSocketActions","UserAgent","Utils","store","params","_classCallCheck3","default","_possibleConstructorReturn3","__proto__","_getPrototypeOf2","onUserChanged","bind","user","UserStore","root","document","getElementById","className","areObjectsEqual","setState","ErrorStore","clearLastError","initialize","props","getBrowserTimezone","_jquery2","window","on","off","cookie","indexOf","viewChannel","ChannelStore","getCurrentId","close","addChangeListener","addEventListener","onFocusListener","onBlurListener","isIos","addClass","isAndroid","attr","emitUserLoggedOutEvent","encodeURIComponent","location","pathname","ev","type","removeClass","closest","find","e","which","is","preventDefault","removeChangeListener","removeEventListener","isValidState","_react2","createElement","_loading_screen2","Redirect","to","children","emitBrowserFocus","React","Component","propTypes","PropTypes","object","bool","isRequired","shape","func"],"mappings":"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","file":"8.24294d6912a5c074fd8b.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nexports.autoUpdateTimezone = autoUpdateTimezone;\n\nvar _users = require('../selectors/entities/users');\n\nvar _timezone = require('../selectors/entities/timezone');\n\nvar _users2 = require('./users');\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; } // Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\n\nfunction autoUpdateTimezone(deviceTimezone) {\n    var _this = this;\n\n    return function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(dispatch, getState) {\n            var currentUer, currentTimezone, newTimezoneExists, timezone, updatedUser;\n            return regeneratorRuntime.wrap(function _callee$(_context) {\n                while (1) {\n                    switch (_context.prev = _context.next) {\n                        case 0:\n                            currentUer = (0, _users.getCurrentUser)(getState());\n                            currentTimezone = (0, _timezone.getUserTimezone)(getState(), currentUer.id);\n                            newTimezoneExists = currentTimezone.automaticTimezone !== deviceTimezone;\n\n\n                            if (currentTimezone.useAutomaticTimezone && newTimezoneExists) {\n                                timezone = {\n                                    useAutomaticTimezone: 'true',\n                                    automaticTimezone: deviceTimezone,\n                                    manualTimezone: currentTimezone.manualTimezone\n                                };\n                                updatedUser = _extends({}, currentUer, {\n                                    timezone: timezone\n                                });\n\n\n                                (0, _users2.updateMe)(updatedUser)(dispatch, getState);\n                            }\n\n                        case 4:\n                        case 'end':\n                            return _context.stop();\n                    }\n                }\n            }, _callee, _this);\n        }));\n\n        return function (_x, _x2) {\n            return _ref.apply(this, arguments);\n        };\n    }();\n}","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport {connect} from 'react-redux';\nimport {bindActionCreators} from 'redux';\nimport {autoUpdateTimezone} from 'mattermost-redux/actions/timezone';\nimport {getLicense, getConfig} from 'mattermost-redux/selectors/entities/general';\n\nimport {shouldShowTermsOfService} from 'mattermost-redux/selectors/entities/users';\n\nimport {checkIfMFARequired} from 'utils/route';\n\nimport LoggedIn from './logged_in.jsx';\n\nfunction mapStateToProps(state, ownProps) {\n    const license = getLicense(state);\n    const config = getConfig(state);\n    const showTermsOfService = shouldShowTermsOfService(state);\n\n    return {\n        mfaRequired: checkIfMFARequired(license, config, ownProps.match.url),\n        enableTimezone: config.ExperimentalTimezone === 'true',\n        showTermsOfService,\n    };\n}\n\nfunction mapDispatchToProps(dispatch) {\n    return {\n        actions: bindActionCreators({\n            autoUpdateTimezone,\n        }, dispatch),\n    };\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(LoggedIn);\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\n\nimport $ from 'jquery';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport {Redirect} from 'react-router';\nimport {viewChannel} from 'mattermost-redux/actions/channels';\n\nimport * as GlobalActions from 'actions/global_actions.jsx';\nimport * as WebSocketActions from 'actions/websocket_actions.jsx';\nimport 'stores/emoji_store.jsx';\nimport UserStore from 'stores/user_store.jsx';\nimport ChannelStore from 'stores/channel_store.jsx';\nimport ErrorStore from 'stores/error_store.jsx';\nimport * as UserAgent from 'utils/user_agent.jsx';\nimport * as Utils from 'utils/utils.jsx';\nimport LoadingScreen from 'components/loading_screen.jsx';\nimport {getBrowserTimezone} from 'utils/timezone.jsx';\nimport store from 'stores/redux_store.jsx';\n\nconst dispatch = store.dispatch;\nconst getState = store.getState;\n\nconst BACKSPACE_CHAR = 8;\n\nexport default class LoggedIn extends React.Component {\n    constructor(params) {\n        super(params);\n\n        this.onUserChanged = this.onUserChanged.bind(this);\n\n        this.state = {\n            user: UserStore.getCurrentUser(),\n        };\n\n        const root = document.getElementById('root');\n        if (root) {\n            root.className += ' channel-view';\n        }\n    }\n\n    isValidState() {\n        return this.state.user != null;\n    }\n\n    onUserChanged() {\n        // Grab the current user\n        const user = UserStore.getCurrentUser();\n\n        if (!Utils.areObjectsEqual(this.state.user, user)) {\n            this.setState({\n                user,\n            });\n        }\n    }\n\n    UNSAFE_componentWillMount() { // eslint-disable-line camelcase\n        ErrorStore.clearLastError();\n    }\n\n    componentDidMount() {\n        // Initialize websocket\n        WebSocketActions.initialize();\n\n        if (this.props.enableTimezone) {\n            this.props.actions.autoUpdateTimezone(getBrowserTimezone());\n        }\n\n        // Make sure the websockets close and reset version\n        $(window).on('beforeunload',\n            () => {\n                // Turn off to prevent getting stuck in a loop\n                $(window).off('beforeunload');\n                if (document.cookie.indexOf('MMUSERID=') > -1) {\n                    viewChannel('', ChannelStore.getCurrentId() || '')(dispatch, getState);\n                }\n                WebSocketActions.close();\n            }\n        );\n\n        // Listen for user\n        UserStore.addChangeListener(this.onUserChanged);\n\n        // Listen for focused tab/window state\n        window.addEventListener('focus', this.onFocusListener);\n        window.addEventListener('blur', this.onBlurListener);\n\n        // Because current CSS requires the root tag to have specific stuff\n\n        // Device tracking setup\n        if (UserAgent.isIos()) {\n            $('body').addClass('ios');\n        } else if (UserAgent.isAndroid()) {\n            $('body').addClass('android');\n        }\n\n        if (!this.state.user) {\n            $('#root').attr('class', '');\n            GlobalActions.emitUserLoggedOutEvent('/login?redirect_to=' + encodeURIComponent(this.props.location.pathname), true, false);\n        }\n\n        $('body').on('mouseenter mouseleave', '.post', function mouseOver(ev) {\n            if (ev.type === 'mouseenter') {\n                $(this).prev('.date-separator, .new-separator').addClass('hovered--after');\n                $(this).next('.date-separator, .new-separator').addClass('hovered--before');\n            } else {\n                $(this).prev('.date-separator, .new-separator').removeClass('hovered--after');\n                $(this).next('.date-separator, .new-separator').removeClass('hovered--before');\n            }\n        });\n\n        $('body').on('mouseenter mouseleave', '.search-item__container .post', function mouseOver(ev) {\n            if (ev.type === 'mouseenter') {\n                $(this).closest('.search-item__container').find('.date-separator').addClass('hovered--after');\n                $(this).closest('.search-item__container').next('div').find('.date-separator').addClass('hovered--before');\n            } else {\n                $(this).closest('.search-item__container').find('.date-separator').removeClass('hovered--after');\n                $(this).closest('.search-item__container').next('div').find('.date-separator').removeClass('hovered--before');\n            }\n        });\n\n        $('body').on('mouseenter mouseleave', '.post.post--comment.same--root', function mouseOver(ev) {\n            if (ev.type === 'mouseenter') {\n                $(this).prev('.date-separator, .new-separator').addClass('hovered--comment');\n                $(this).next('.date-separator, .new-separator').addClass('hovered--comment');\n            } else {\n                $(this).prev('.date-separator, .new-separator').removeClass('hovered--comment');\n                $(this).next('.date-separator, .new-separator').removeClass('hovered--comment');\n            }\n        });\n\n        // Prevent backspace from navigating back a page\n        $(window).on('keydown.preventBackspace', (e) => {\n            if (e.which === BACKSPACE_CHAR && !$(e.target).is('input, textarea')) {\n                e.preventDefault();\n            }\n        });\n    }\n\n    componentWillUnmount() {\n        WebSocketActions.close();\n        UserStore.removeChangeListener(this.onUserChanged);\n\n        $('body').off('click.userpopover');\n        $('body').off('mouseenter mouseleave', '.post');\n        $('body').off('mouseenter mouseleave', '.post.post--comment.same--root');\n\n        $('.modal').off('show.bs.modal');\n\n        $(window).off('keydown.preventBackspace');\n\n        // Listen for focussed tab/window state\n        window.removeEventListener('focus', this.onFocusListener);\n        window.removeEventListener('blur', this.onBlurListener);\n    }\n\n    render() {\n        if (!this.isValidState()) {\n            return <LoadingScreen/>;\n        }\n\n        if (this.props.mfaRequired) {\n            if (this.props.location.pathname !== '/mfa/setup') {\n                return <Redirect to={'/mfa/setup'}/>;\n            }\n        } else if (this.props.location.pathname === '/mfa/confirm') {\n            // Nothing to do. Wait for MFA flow to complete before prompting TOS.\n        } else if (this.props.showTermsOfService) {\n            if (this.props.location.pathname !== '/terms_of_service') {\n                return <Redirect to={'/terms_of_service?redirect_to=' + encodeURIComponent(this.props.location.pathname)}/>;\n            }\n        }\n\n        return this.props.children;\n    }\n\n    onFocusListener() {\n        GlobalActions.emitBrowserFocus(true);\n    }\n\n    onBlurListener() {\n        GlobalActions.emitBrowserFocus(false);\n    }\n}\n\nLoggedIn.propTypes = {\n    children: PropTypes.object,\n    mfaRequired: PropTypes.bool.isRequired,\n    enableTimezone: PropTypes.bool.isRequired,\n    actions: PropTypes.shape({\n        autoUpdateTimezone: PropTypes.func.isRequired,\n    }).isRequired,\n    showTermsOfService: PropTypes.bool.isRequired,\n};\n"],"sourceRoot":""}